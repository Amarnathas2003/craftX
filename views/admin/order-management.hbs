<section>
  <nav class="navbar navbar-expand-lg bg-body-dark">
    <div class="container-fluid" style="height: 50px;">
      <a class="navbar-brand" href="/admin/home">CraftX</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <form class="d-flex" role="search">
          {{!-- <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success" type="submit" style="margin-right: 10px;">Search</button>
          --}}
          {{!-- <button class="addCat"><a href="category/newcategory"></a>Add Category</button> --}}
        </form>
      </div>
    </div>
  </nav>
</section>
<hr>


<section>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-4" style="width: 250px;">
        <div class="list-group">
          <li class="list-group-item"><a href="/admin/products"> <i
                class="fa-solid fa-box-open side-bar-icon"></i>Products</a></li>
          <li class="list-group-item"><a href=""><i class="fa-regular fa-user side-bar-icon"></i>Customers</a>
          </li>
          <li class="list-group-item"><a href=""><i class="fa-solid fa-cart-shopping side-bar-icon"></i>Orders</a></li>
          <li class="list-group-item"><a href="category"><i
                class="fa-solid fa-table-cells-large fa-custom-icon side-bar-icon"></i>Category</a></li>
          <li class="list-group-item"><a href=""> <i class="fa-solid fa-arrow-up-from-bracket side-bar-icon"
                style="transform: rotate(90deg);"></i>Sales Report</a></li>
          <li class="list-group-item"><a href=""><i class="fa-solid fa-money-bill-wave side-bar-icon"></i>Manage
              Coupon</a></li>
          <li class="list-group-item"><a href=""><i class="fa-solid fa-font-awesome side-bar-icon"></i>Banner
              Manage</a></li>
        </div>

        <div class="btn-container d-flex justify-content-center align-items-inline mt-5">
          <a href="logout" class="btn border-primary-subtle">Log Out</a>
          <a href="/admin/home" class="btn border-primary-subtle" style="margin-left: 40px;">Back</a>
        </div>
      </div>

      {{!-- //Displaying the details --}}

      <div class="col-md-8" style="width: 1000px;">
        <section class="category d-flex mt-2">
          <div class="object-fit-contain mt-3" style="width: 100%;">
            <div class="header d-flex justify-content-between">
              <h3 class="h3 text-second fw-bold mb-3">Orders</h3>
            </div>
            <table style="width: 100%;" id="customerTable" class="table table-striped table-bordered table-sm"
              cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th class="th-sm">Customer Name</th>
                  <th class="th-sm">Product Name</th>
                  <th class="th-sm">Order Date</th>
                  <th class="th-sm">Products Count</th>
                  <th class="th-sm">Amount</th>
                  <th class="th-sm">Order State</th>
                  <th class="th-sm">Address</th>
                  <th class="th-sm">Order Status</th>
                  <th class="th-sm">Payment Method</th>
                  <th class="th-sm">Manage</th>
                </tr>
              </thead>
              <tbody>
                {{#each orderDetails}}
                {{#each orderItems}}
                <tr>
                  <td>{{../customerName}}</td>
                  <td style="font-weight: bold;">{{this.productName}} (Quantity: {{this.quantity}})</td>
                  <td>{{../orderDate}}</td>
                  <td style="font-weight: bold; color: green">{{this.quantity}}</td>
                  <td style="font-weight: bold; color: green">{{this.unitPrice}}</td>
                  <td style="color: rgb(208, 71, 17);">{{../orderState}}</td>

                  {{!-- user chosen address --}}
                  <td style="font-weight: bold;">
                    {{../customerAddress.userName}}<br>
                    {{../customerAddress.address}}<br>
                    {{../customerAddress.locality}}, {{../customerAddress.town}},
                    {{../customerAddress.state}}<br>
                    {{../customerAddress.pinCode}}
                  </td>

                  {{!-- Specific Product Status --}}
                  <td style="color: green; font-weight: bold;">{{this.orderStatus}}</td>

                  <td style="font-weight: bold;">{{../payment_method}}</td>

                  <td>
                    <a href="/admin/orders/editOrder?orderId={{../orderId}}&productID={{this.productID}}"
                      class="btn btn-success border border-dark">Manage</a>
                  </td>

                  {{!-- <td>
                    <button class="btn btn-success border border-dark manage-button" data-orderId="{{../orderId}}"
                      data-productID="{{this.productID}}">Manage</button>
                  </td> --}}

                </tr>
                {{/each}}
                {{/each}}
              </tbody>
            </table>


          </div>
        </section>
      </div>


    </div>
  </div>
  </div>
</section>



<script>


  document.addEventListener("click", async (event) => {
    if (event.target.classList.contains("manage-button")) {

      const orderId = event.target.getAttribute("data-orderId");
      const productID = event.target.getAttribute("data-productID");

      if (orderId && productID) {

        try {

          const url = `orders/editOrder/${orderId}/${productID}`;

          const response = await fetch(url, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' },
          });

          {
            {
              !-- if (response.ok) {

              } else {
                console.error("Error:", response.statusText);
              } --}
          }

        } catch (error) {
          console.error("Fetch error:", error);
        }
      }
    }
  });

</script>




<style>
  a {
    text-decoration: none;
  }

  i {
    margin-right: 20px;
  }

  .btn2 {
    border: 1px solid black;
    color: white;
    border-radius: 5px;
    padding: 7px;
  }

  .backBtn {
    margin-left: 20px;
    color: black;
  }

  .logout_btn {
    margin-top: 50px;
    margin-left: 10px;
    border: 1px solid black;
    background-color: rgb(231, 126, 126);
  }
</style>